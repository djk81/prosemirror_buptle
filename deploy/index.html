<!DOCTYPE html>
<meta charset="utf8" />
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<header>
	<script src="https://unpkg.com/konva@3.3.3/konva.min.js"></script>
    <link rel="stylesheet" href="https://prosemirror.net/css/editor.css" />
	<style>

		span.buptleparam_content_required_none{
			color:red;
			background-color:black;
		}

		span.default_buptle_required{
			color:white;
			background-color:black;
		}

		.btpm_add_comment_menu{
			background-color: lightcyan;
			color: black;
			border-radius: 3px;
		}

		/** 여기가 본문에서 노랗게 변하는 애들 */
		.blame-marker {
		    /*background-color: #ff8;*/
		    background-color: lightgreen;
			/*border: 2px dashed black;*/
			padding : 3px 3px 3px 3px;
			opacity: 0.9;
			/*box-shadow: 2px 2px 1px 1px grey;*/
		  }
		.commit:hover {
		    background: #ff8;
		  }
		  .commit-revert {
		    color: #a22;
		  }

		.comment {
		    background-color: lightpink;
		}
		.subtle { color: #777 }

		/*.comment { background-color: #ff8 }*/
		.currentComment { background-color: #fe0 }

		.commentList, .commentText {
		  display: block;
		  padding: 0;
		  margin: 0;
			box-shadow: 2px 2px 1px 1px grey;
		}

		.tooltip-wrapper {
		  display: inline-block;
		  position: relative;
		  width: 0;
		  overflow: visible;
		  vertical-align: bottom;
		}

		.ProseMirror ul.commentList {
		  font-family: "Source Sans Pro";
		  font-size: 16px;
		  width: 15em;
		  position: absolute;
		  top: calc(100% + 8px);
		  left: -2em;
		  font-size: 1rem;
		  color: black;
		  background: white;
		  font-weight: normal;
		  border: 1px solid #888;
		  border-radius: 5px;
		  z-index: 10;
		  padding: 0;
		}

		ul.commentList::before {
		  border: 5px solid black;
		  border-top-width: 0px;
		  border-left-color: transparent;
		  border-right-color: transparent;
		  position: absolute;
		  top: -5px;
		  left: calc(2em - 6px);
		  content: " ";
		  height: 0;
		  width: 0;
		}

		li.commentText {
		  padding: 20px 10px 20px 10px;
		   position:  relative;
		  pointer-events: auto;
		  margin: 0;
			background-color: red;
			opacity: 0.8;
			color:white;
			border: 1px solid black;
			border-radius: 5px;
		}

		li.commentText + li.commentText {
		  border-top: 1px solid black;
		}

		.commentDelete {
		  position: relative;
			top:10px;
		  left: 0;
		  left-margin: 0;
		  left-padding: 0;
		  border: 0;
		  font: inherit;
		  display: block;
		  color: inherit;
		  background: transparent;
		  cursor: pointer;
			font-size: small;
			text-decoration: underline;
		}

		.commentDelete:hover {
		  color: #f88;
		}

		.doclist {
		  z-index: 20;
		  display: block;
		  padding: 2px 2px;
		  margin: 0;
		  border: 1px solid silver;
		  position: absolute;
		  background: white;
		  font-size: 90%;
		  box-sizing: border-box;
		  -moz-box-sizing: border-box;
		  max-height: 15em;
		  overflow-y: auto;
		}

		.doclist li {
		  display: block;
		  padding: 1px 3px;
		  margin: 0;
		  cursor: pointer;
		}

		.doclist li:hover {
		  background: #5ae;
		  color: white;
		}

		.docinfo {
		  position: relative;
		  color: #555;
		}

		.ProseMirror-report {
		  position: fixed;
		  top: 0; right: 0; left: 0;
		  border-width: 0;
		  border-style: solid;
		  border-bottom-width: 1px;
		  padding: 3px 27px 5px;
		  white-space: pre;
		  z-index: 1000;
		}

		.ProseMirror-report-fail {
		  background: rgb(255, 230, 230);
		  border-color: rgb(200, 150, 150);
		}

		.ProseMirror-report-delay {
		  background: rgb(255, 255, 200);
		  border-color: rgb(200, 200, 120);
		}
	</style>
</header>

<body>
	<br/>
	<div>
		<h2>BUPTLE - Prosemirror (IE 버전은 빌드 수정 작업중. 크롬에서만 사용가능)</h2>
	</div>
	<br/>

	<form id="commit">
        저장 커밋메시지 <input type=text id=message name=message> <button id=commitbutton type="button" onclick="">버전저장</button>
        <div class=blame-wrap>
	        <button type="button" id="blame" style="display:none;">blame at cursor</button>
        </div>
	</form>

    <div id="commits" style="margin-bottom: 23px;">
	    <!--<div class="commit"><span class="commit-time">11:18</span>&nbsp; Initial commit&nbsp; <button class="commit-revert">revert</button></div><div class="commit"><span class="commit-time">11:18</span>&nbsp; Unnamed&nbsp; <button class="commit-revert">revert</button></div><div class="commit"><span class="commit-time">11:19</span>&nbsp; Unnamed&nbsp; <button class="commit-revert">revert</button></div>-->
    </div>
	<div id="changedoc" style="position: relative; float:left; display: none; ">문서종류</div>
	<div id="docname" style="position: relative; float:left; display: none; ">문서명</div>
	<div id="users">유저수</div>
	<script>
		function fn_test(){
			document.getElementsByClassName('temp_text')[0].innerHTML = '<span class="temp_text default_buptle_required">가나다라마바사아차카타타파하</span>';
		}
	</script>

	<br/>
	<div style="width:800px; margin-bottom: 23px; position: absolute; max-height:900px; float:left; ">
		<!--style="overflow-y:scroll; max-height:700px;"-->
		<div id="editor" >

		</div>
	</div>

	<div style="background-color: mintcream; left: 800px; width:300px; position: fixed; float:left; top:60px; border: 2px solid #55aaee; margin-left:20px; border-radius: 5px;">
		<!---->
		<div>
			<button type="button" id="add_comment_to_doc" style="margin: 2px 0px 6px 6px;" onclick="ProseMirror.onCommentAddClicked();">코멘트남기기</button>
		</div>
		<div id="indexhtml_comment_list_wrapper" style="overflow-y:scroll; max-height: 600px; ">
		</div>
		<button type="button" onclick="javaScript:fn_test();">테스트</button>

	</div>

	<div style="background-color: white; color:black; left: 800px; min-width:300px; position: fixed; float:left; top:715px;
	border: 2px solid black; margin-left:20px; border-radius: 5px; opacity: 0.7;">
		<!---->
		<div>
			<!--<button type="button" id="version_btn" style="margin: 2px 0px 6px 6px;" onclick=""></button>-->
		</div>
		<div id="_version_list_wrapper" style="padding-left:5px; overflow-y:scroll; min-height: 200px; max-height: 200px; ">
			버전 History 가 표시됩니다.
			<!--<div class="commit"><span class="commit-time">11:18</span>&nbsp; Initial commit&nbsp; <button class="commit-revert">revert</button></div><div class="commit"><span class="commit-time">11:18</span>&nbsp; Unnamed&nbsp; <button class="commit-revert">revert</button></div><div class="commit"><span class="commit-time">11:19</span>&nbsp; Unnamed&nbsp; <button class="commit-revert">revert</button></div>-->
		</div>
	</div>


	<div id="content" style="display: none;">
		<p>피<pre>자식</pre></p>
		<p>
			<span id="temp_text" class="temp_text">
				<label for="temp_text">라벨1</label>
			</span>
		</p>
		<p>
			<span class="tyrannosaurus buptle_required" title="필수입력필드입니다." contenteditable="false" draggable="true">
				3333333
			</span>
		</p>

		<p>
		<span data-param-id="384" data-param-name="00000" data-param-content="" data-param-desc="" data-param-required="1"
		      class="buptleparam_content_required_none" contenteditable="false" draggable="false"
		      onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : 00000 ] ">
			<label> [ 입력필요 : 00000 ] </label>
		</span>
		</p>
		<p><br></p><p align="center"><strong>가운데</strong></p>

		<p align="center"><strong>수 정 합 의 서 </strong></p><p align="center"><br></p><p align="center"><br></p><p align="center"><br></p>
		<p align="left">주식회사 지에스홈쇼핑(이하 “갑”이라 한다)과
			<span type="default_buptle_required"
			      data-param-id="384" data-param-name="00000" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : 00000 ] "><label> [ 입력필요 : 00000 ] </label></span>&nbsp;(이하 “을”이라 함)은 양 당사자 간에 <span data-param-id="572" data-param-name="(체결일) 2000년 00월 00일" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (체결일) 2000년 00월 00일 ] "><label> [ 입력필요 : (체결일) 2000년 00월 00일 ] </label></span>&nbsp; 체결한 “<span data-param-id="6" data-param-name="000000계약" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : 000000계약 ] "><label> [ 입력필요 : 000000계약 ] </label></span>&nbsp;” (이하 “원 계약서”라 함)을 다음과 같이 수정하기로 한다.</p><p><br></p><p><br></p><p><br></p><ol><li><strong>“</strong><strong>원 계약서</strong><strong>”</strong><strong>에 따라 </strong><strong>“</strong><strong>갑</strong><strong>”</strong><strong>이 </strong><strong>“</strong><strong>을</strong><strong>”</strong><strong>에게 지급하여야 하는 대금을 다음과 같이 변경한다.</strong></li></ol><table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td valign="top" width="92"><p align="center"><br></p></td><td valign="top" width="113"><p align="center">구분(명칭)</p></td><td valign="top" width="161"><p align="center">대금</p></td><td valign="top" width="180"><p align="center">비고(적용시기)</p></td></tr><tr><td width="92"><p align="center">변경 전</p></td><td valign="top" width="113"><p align="center"><span data-param-id="904" data-param-name="(변경 전) 000사용료" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (변경 전) 000사용료 ] "><label> [ 입력필요 : (변경 전) 000사용료 ] </label></span>&nbsp;</p></td><td valign="top" width="161"><p align="center"><span data-param-id="559" data-param-name="(변경 전) 000,000,000원/월" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (변경 전) 000,000,000원/월 ] "><label> [ 입력필요 : (변경 전) 000,000,000원/월 ] </label></span></p></td><td valign="top" width="180"><p align="center"><span data-param-id="265" data-param-name="(변경 전) 0000년 00월 00일부터" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (변경 전) 0000년 00월 00일부터 ] "><label> [ 입력필요 : (변경 전) 0000년 00월 00일부터 ] </label></span>&nbsp;</p></td></tr><tr><td width="92"><p align="center">변경 후</p></td><td valign="top" width="113"><p align="center"><span data-param-id="722" data-param-name="(변경 후) 000사용료" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (변경 후) 000사용료 ] "><label> [ 입력필요 : (변경 후) 000사용료 ] </label></span>&nbsp;</p></td><td valign="top" width="161"><p align="center"><span data-param-id="553" data-param-name="(변경 후) 000,000,000원/월" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (변경 후) 000,000,000원/월 ] "><label> [ 입력필요 : (변경 후) 000,000,000원/월 ] </label></span></p></td><td valign="top" width="180"><p align="center"><span data-param-id="881" data-param-name="(변경 후) 0000년 00월 00일부터" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-display-name=" [ 입력필요 : (변경 후) 0000년 00월 00일부터 ] "><label> [ 입력필요 : (변경 후) 0000년 00월 00일부터 ] </label></span>&nbsp;</p></td></tr></tbody></table><p><br></p><ol start="2"><li><strong>“</strong><strong>원 계약서”와 본 합의서의 해석이 충돌하는 경우 본 합의서가 </strong><strong>우선하며</strong><strong>, </strong><strong>본 합의서에 규정되지 아니한 사항은 “원 계약서”에 따른다. </strong></li><li><strong>본 합의서는 체결 즉시 효력을 발생한다. </strong></li></ol><p><br></p><p><br></p><p><br></p><p><br></p><p align="center"><span data-param-id="281" data-param-name="2000년 00월 00일" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="text" data-param-display-name=" [ 입력필요 : 2000년 00월 00일 ] "><label> [ 입력필요 : 2000년 00월 00일 ] </label></span>&nbsp;</p><p align="center"><br></p><p><br></p><p>"갑"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; “을”</p><p>주식회사 지에스홈쇼핑&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span data-param-id="475" data-param-name="주식회사 00000" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : 주식회사 00000 ] "><label> [ 입력필요 : 주식회사 00000 ] </label></span>&nbsp;</p><p>서울시 영등포구 선유로 75&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span data-param-id="339" data-param-name="(주소입력란 1)" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : (주소입력란 1) ] "><label> [ 입력필요 : (주소입력란 1) ] </label></span>&nbsp;</p><p>지에스강서타워&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span data-param-id="407" data-param-name="(주소입력란 2)" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : (주소입력란 2) ] "><label> [ 입력필요 : (주소입력란 2) ] </label></span>&nbsp;</p><p>대표이사 허 태 수 (인)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span data-param-id="647" data-param-name="대표이사 0&nbsp; 0&nbsp; 0" data-param-content="" data-param-desc="" data-param-required="1" class="buptleparam_content_required_none" contenteditable="false" draggable="false" onclick="parent.viewModal(this)" data-param-kind="null" data-param-display-name=" [ 입력필요 : 대표이사 0&nbsp; 0&nbsp; 0 ] ">
				<label> [ 입력필요 : 대표이사 0&nbsp; 0&nbsp; 0 ] </label>
			</span>&nbsp;&nbsp;(인)
		</p>
	</div>



	<script src="../dist/buptle_editor.js"></script>
	<script>

		try{
		    var activate_plugins = false
		    var _editorSpec = new ProseMirror.EditorSpec();
		    if(activate_plugins){
				_editorSpec.div_target_id = 'editor';
				_editorSpec.is_memo_activate = true
				_editorSpec.is_track_changes_activate = true
				_editorSpec.div_comments_target_id = 'indexhtml_comment_list_wrapper';
				_editorSpec.get_document_html_handler = function(){
					return document.querySelector("#content")
				};
				_editorSpec.functions = {
					get_comments : function(){
					    // var rtn = {
					    //     comments : [
					    //         {
					    //         from : 0,
					    //         to : 2,
					    //         text: '_default comment',
					    //         id : '1234'
					    //         }
					    //     ]
					    // };
					    return null;
					},
				};

		    }else{
				_editorSpec.div_target_id = 'editor';
				_editorSpec.get_document_html_handler = function(){
					return document.querySelector("#content")
				};
		    }
		}catch(e){
		    window.console.log(e);
		}

		ProseMirror.editorInitBySpec(_editorSpec);
		// ProseMirror.EditorInit("editor", "content");

		window.addEventListener('DOMContentLoaded', function(){
		    var _rs_fields = document.querySelectorAll('.buptleparam_content_required_none');
		    for(var i=0; i<_rs_fields.length; i++){
			    _rs_fields[i].addEventListener("click", function(){
	                alert(this.innerText);
	                this.innerText = '입력했음';
	            }, false)

		    }
		})

		//콘바다음에
      // var width = window.innerWidth;
      // var height = window.innerHeight;
      //
      // var stage = new Konva.Stage({
      //   container: '_comments_bt_id_1783625414',
      //   width: width,
      //   height: height
      // });
      //
      // var layer = new Konva.Layer();
      //
      // var arrow = new Konva.Arrow({
      //   x: stage.width() / 4,
      //   y: stage.height() / 4,
      //   points: [0, 0, width / 2, height / 2],
      //   pointerLength: 20,
      //   pointerWidth: 20,
      //   fill: 'black',
      //   stroke: 'black',
      //   strokeWidth: 0.5
      // });
      //
      // arrow.setAttr('points', [0, 0, 100, 100]);
      //
      // // add the shape to the layer
      // layer.add(arrow);
      //
      // // add the layer to the stage
      // stage.add(layer);

	</script>
</body>
</html>